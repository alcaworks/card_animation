<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multi Lottie Animation Panels</title>
  <style>
    :root {
      --accent: #66ffff;
      --bg: #1a1a1a;
      --panel-bg: #111;
      --border: rgba(255, 255, 255, 0.9);
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--accent);
      font-family: Arial, Helvetica, sans-serif;
    }

    body {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      gap: 24px;
      padding: 40px;
      box-sizing: border-box;
      overflow-y: auto;
      overflow-x: hidden;
    }

    /* 固定サイズ（PC基準） */
    .panel {
      width: 360px;
      height: 480px;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: hidden;
      position: relative;
      box-sizing: border-box;
    }

    .title {
      text-align: center;
      font-size: 1.4rem;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .lottie-container {
      position: relative;
      flex: 1;
      min-height: 400px;
      width: 100%;
    }

    .lottie {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.6s ease;
    }

    .lottie.visible {
      opacity: 1;
    }

    .message {
      text-align: center;
      font-size: 1.2rem;
      color: var(--accent);
      cursor: pointer;
      padding: 8px 0;
      user-select: none;
      transition: opacity 0.3s ease;
    }

    .message.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .message.restart {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="panels-container"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
  <script>
    const TITLES = ["KAG","NDT","RAG","TNW","YUR"];
    const ANIM_PATH = (prefix, idx) => `animations/${prefix}_${idx}.json`;
    const container = document.getElementById("panels-container");

    TITLES.forEach(title => {
      const panel = document.createElement("div");
      panel.className = "panel";
      panel.innerHTML = `
        <div class="title">${title}</div>
        <div class="lottie-container">
          <div id="${title}_anim1" class="lottie"></div>
          <div id="${title}_anim2" class="lottie"></div>
          <div id="${title}_anim3" class="lottie"></div>
        </div>
        <div id="${title}_msg" class="message hidden">tap（click）</div>
        <div id="${title}_restart" class="message hidden restart">Restart</div>
      `;
      container.appendChild(panel);
    });

    function createSequence(prefix){
      const a1=document.getElementById(`${prefix}_anim1`);
      const a2=document.getElementById(`${prefix}_anim2`);
      const a3=document.getElementById(`${prefix}_anim3`);
      const msg=document.getElementById(`${prefix}_msg`);
      const restart=document.getElementById(`${prefix}_restart`);
      let current=0;

      const fadeIn=el=>el.classList.add("visible");
      const fadeOut=el=>el.classList.remove("visible");
      const show=m=>m.classList.remove("hidden");
      const hide=m=>m.classList.add("hidden");

      const anim1=lottie.loadAnimation({container:a1,renderer:"svg",loop:false,autoplay:false,path:ANIM_PATH(prefix,1)});
      const anim2=lottie.loadAnimation({container:a2,renderer:"svg",loop:true,autoplay:false,path:ANIM_PATH(prefix,2)});
      const anim3=lottie.loadAnimation({container:a3,renderer:"svg",loop:false,autoplay:false,path:ANIM_PATH(prefix,3)});

      anim1.addEventListener("DOMLoaded",()=>{
        anim1.goToAndStop(0,true);
        fadeIn(a1);
        show(msg);
        current=1;
      });

      const next=()=>{
        if(current===1){
          hide(msg);
          anim1.goToAndPlay(0,true);
          anim1.addEventListener("complete",()=>{
            fadeOut(a1);
            setTimeout(()=>{
              fadeIn(a2);
              anim2.play();
              setTimeout(()=>show(msg),1500);
              current=3;
            },600);
          },{once:true});
        }else if(current===3){
          hide(msg);
          fadeOut(a2);
          setTimeout(()=>{
            fadeIn(a3);
            anim3.goToAndPlay(0,true);
            anim3.addEventListener("complete",()=>{
              show(restart);
              current=4;
            },{once:true});
          },600);
        }else if(current===4){
          hide(restart);
          fadeOut(a3);
          setTimeout(()=>{
            anim1.goToAndStop(0,true);
            anim2.stop();
            anim3.stop();
            fadeIn(a1);
            show(msg);
            current=1;
          },600);
        }
      };

      msg.addEventListener("click",next);
      restart.addEventListener("click",next);
      msg.addEventListener("touchstart",e=>{e.preventDefault();next();},{passive:false});
      restart.addEventListener("touchstart",e=>{e.preventDefault();next();},{passive:false});
    }

    TITLES.forEach(t=>createSequence(t));
  </script>
</body>
</html>
